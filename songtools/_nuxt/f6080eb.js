(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{585:function(e,t,r){var content=r(623);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(28).default)("9f17f290",content,!0,{sourceMap:!1})},622:function(e,t,r){"use strict";r(585)},623:function(e,t,r){var o=r(27)(!1);o.push([e.i,".container[data-v-ac03a8c2]{min-width:230px}.requirement-item .icon[data-v-ac03a8c2]{left:0;top:.65rem}",""]),e.exports=o},634:function(e,t,r){"use strict";r.r(t);var o=r(0),n=(r(15),r(86),r(65),r(31),r(11),r(73),r(80),r(54),r(59),r(46),r(87),{props:{resource:{type:Object,default:function(){}},wizardCode:{type:Object,default:function(){}},folderOrder:{type:Number,default:1},spaceUsed:{type:Number,default:0},spaceAllowed:{type:Number,default:0},updateResource:{type:Function,default:function(){}},requiredPurchase:{type:Boolean,default:!1},stockResourceSelection:{type:Object,default:function(){}},hasPremiumAccess:{type:Boolean,default:!0}},data:function(){return{UploadError:null,ApproximateUploadTime:null,UploadFinishesOn:null,UploadProgress:null}},computed:{uploadAllowed:function(){return this.spaceUsed<this.spaceAllowed&&!("SongCover"==this.resource.WizardCode&&""!=this.resource.FileCreatedOn)},status:function(){return this.resource&&this.resource.FileStatus?this.resource.FileStatus:null},requirements:function(){return this.wizardCode&&this.wizardCode.Requirements&&""!=this.wizardCode.Requirements?this.wizardCode.Requirements.split(","):null},selectedSong:function(){return this.$store.getters["artist/selectedSong"]},acceptedFileTypes:function(){var e=this,t=this.$store.getters["songfolder/fileTypes"];return t&&t.length>0&&this.wizardCode?t.filter((function(t){return t.MediaType==e.wizardCode.MediaType})).map((function(e){return"."+e.Extension})).toString():null},SFHeaders:function(){return this.$store.getters["songfolder/sfHeaders"]},SFRoot:function(){return this.$store.getters["songfolder/sfRoot"]},fileTypes:{get:function(){return this.$store.getters["songfolder/fileTypes"]},set:function(e){this.$store.dispatch("songfolder/onSetFileTypes",e)}}},mounted:function(){},methods:{onProcessUploadClick:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("SongCover"!=e.resource.WizardCode){t.next=19;break}return console.log("processing here"),e.UploadProgress=10,t.prev=3,t.next=6,e.$api.artist.prepareNewSongAssets({tid:e.selectedSong.TrackId,genres:e.selectedSong.Genres.toString()});case 6:return t.sent,e.UploadProgress=60,t.next=10,e.$nuxt.$emit("onLoadSongFolderFiles");case 10:e.UploadProgress=100,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),console.warn(t.t0);case 16:e.UploadProgress=null,t.next=20;break;case 19:e.$refs.fileUploader.click();case 20:case"end":return t.stop()}}),t,null,[[3,13]])})))()},onBeginFileUpload:function(e){var t=e.target.files[0];this.UploadError=null,this.uploadThisFile(t)},uploadThisFile:function(e,t){var r=this;if(this.wizardCode){var o=this;this.UploadError=null;var body={fileId:"sf_".concat(this.generateUUID()),WizardCode:this.wizardCode.Code,Metadata:this.wizardCode.MediaType,Name:this.wizardCode.Name,Description:this.wizardCode.Description,FolderOrder:o.folderOrder};switch(o.selectedSong&&o.selectedSong.TrackId&&(body.SpotifySongId=o.selectedSong.TrackId,body.spotifySongName=o.selectedSong.Name),this.ApproximateUploadTime=null,this.UploadFinishesOn=null,this.UploadProgress=1,t){case"url":this.getBase64FromImage(e,(function(t){var n=t.substr(t.indexOf("data:"),t.indexOf(";base64"));n=n.substr(n.indexOf(":")+1,n.length);var l=o.fileTypes.filter((function(e){return e.MimeType==n})).map((function(e){return e.Extension}))[0];body.fileExtension=l,body.filename="default_".concat(body.WizardCode,".").concat(body.fileExtension),body.url=e,r.UploadProgress=10,o.uploadResourceToSongFolder(body)}),(function(e){console.warn(e)}));break;case"stock":this.getBase64FromImage(e,(function(t){var n=t.substr(t.indexOf("data:"),t.indexOf(";base64"));n=n.substr(n.indexOf(":")+1,n.length);var l=o.fileTypes.filter((function(e){return e.MimeType==n})).map((function(e){return e.Extension}))[0];body.fileExtension=l,body.filename="default_".concat(body.WizardCode,".").concat(body.fileExtension),body.attribution=r.stockResourceSelection.Attribution,body.attributionUrl=r.stockResourceSelection.AttributionUrl,body.source=r.stockResourceSelection.AttributionUrl.includes("pexels")?"https://www.pexels.com/":"https://unsplash.com/",body.url=e,r.UploadProgress=10,o.uploadResourceToSongFolder(body)}),(function(e){console.warn(e)}));break;default:var n=e;body.filename=n.name,body.fileExtension=body.filename.split(".").pop();var l=new FileReader;l.readAsBinaryString(n),l.onload=function(){var e=btoa(l.result);body.bytes=e,o.uploadResourceToSongFolder(body)},l.onError=function(e){console.warn("SF error",e)}}}},uploadResourceToSongFolder:function(body){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e,e.UploadProgress=1,t.prev=2,t.next=5,e.$api.data.post("".concat(r.SFRoot,"/sf_users/UploadFileAsync/songfolder"),JSON.stringify(body),{headers:r.SFHeaders});case 5:(o=t.sent)&&o.data?(console.log(o.data),e.ApproximateUploadTime=o.data.data.extimatedSecondsToUpload,n=new Date,e.UploadFinishesOn=n.addSeconds(e.ApproximateUploadTime),r.updateProgressBar(body.fileId)):(console.log(o),e.UploadError="There was an error uploading this file. Please check file requirements try again.",e.UploadProgress=null),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(2),console.warn(t.t0),e.UploadError="There was an error uploading this file.  Please check file requirements try again.",e.UploadProgress=null;case 14:case"end":return t.stop()}}),t,null,[[2,9]])})))()},getUserAssets:function(){console.log("get user assets")},updateProgressBar:function(e,t){var r=this;return Object(o.a)(regeneratorRuntime.mark((function o(){var n,l,c,d,f,h;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(n=r,15,l=(new Date).getSeconds(),c=r.UploadFinishesOn.getSeconds(),!((d=c-l)<=0)){o.next=25;break}if(t||(t=0),!(++t<=15)){o.next=25;break}return r.UploadProgress=t/15*100,o.next=12,r.$api.songfolder.checkFileUploadStatus(e);case 12:if(!(f=o.sent)){o.next=22;break}if(!((h=f[0])&&h.files&&h.files>0)){o.next=20;break}return r.UploadProgress=100,r.updateResource(r.resource,h.URL),setTimeout((function(){n.UploadProgress=null}),1e3),o.abrupt("return");case 20:o.next=25;break;case 22:return r.UploadError="There was an error uploading this file. Please try again.",r.UploadProgress=null,o.abrupt("return");case 25:r.UploadProgress=d/r.ApproximateUploadTime*100,setTimeout((function(){n.updateProgressBar(e,t)}),500);case 27:case"end":return o.stop()}}),o)})))()},onUploadStockResource:function(){this.stockResourceSelection&&this.stockResourceSelection.url&&this.uploadThisFile(this.stockResourceSelection.url,"stock")}}}),l=(r(622),r(8)),component=Object(l.a)(n,(function(){var e=this,t=e._self._c;return e.requiredPurchase?t("div",{staticClass:"container card px-3 py-0 border-0"},[e.hasPremiumAccess||"Verified"==e.resource.FileStatus?[e.wizardCode&&e.wizardCode.MediaType?t("h6",{staticClass:"mt-4"},[e._v("\n      Use Selected "+e._s(String(e.wizardCode.MediaType).toLowerCase())+"\n    ")]):e._e(),e._v(" "),t("p",[e._v("Enter a search term and select a resource to add it to your Songfolder")]),e._v(" "),null!=e.UploadProgress?t("div",[t("div",{staticClass:"progress",staticStyle:{height:"4px"}},[t("div",{staticClass:"progress-bar progress-bar-striped progress-bar-animated bg-primary",style:"width: "+e.UploadProgress+"%",attrs:{role:"progressbar","aria-valuenow":e.UploadProgress,"aria-valuemin":"0","aria-valuemax":"100"}})])]):e._e(),e._v(" "),t("div",{staticClass:"align-self-center py-3 w-100"},["PendingVerification"==e.status?t("button",{staticClass:"btn btn-light btn-rounded w-100 disabled text-nowrap",attrs:{disabled:"disabled"}},[e._v("\n        Pending approval\n      ")]):null!=e.UploadProgress?t("button",{staticClass:"btn btn-light btn-rounded w-100 disabled text-nowrap",attrs:{disabled:"disabled"}},[t("FontAwesomeIcon",{staticClass:"fa-spin",attrs:{icon:["fas","compact-disc"]}}),e._v(" Loading...\n      ")],1):"Verified"==e.resource.FileStatus&&e.uploadAllowed?t("button",{staticClass:"btn btn-rounded btn-outline-dark w-100 text-nowrap",on:{click:function(t){return t.stopPropagation(),e.onUploadStockResource.apply(null,arguments)}}},[e._v("\n        Change\n      ")]):e.uploadAllowed?t("button",{staticClass:"btn btn-rounded btn-primary w-100 text-nowrap",attrs:{disabled:!e.stockResourceSelection},on:{click:function(t){return t.stopPropagation(),e.onUploadStockResource()}}},[e._v("\n        Select Resource\n      ")]):t("button",{staticClass:"btn btn-rounded btn-gray w-100 text-nowrap small"},[e._v("\n        Max Space Reached\n      ")])]),e._v(" "),e.UploadError?t("div",{staticClass:"error text-small p-2",staticStyle:{"font-size":"0.75rem"}},[t("FontAwesomeIcon",{staticClass:"text-danger",attrs:{icon:["fas","exclamation-circle"]}}),e._v(" "),t("span",{staticClass:"text-muted fst-italic"},[e._v(e._s(e.UploadError))])],1):e._e()]:[t("h6",{staticClass:"mt-4"},[e._v("\n      Access with Songfolder Premium\n    ")]),e._v(" "),e.wizardCode&&e.wizardCode.MediaType?t("p",[e._v("\n      Purchase Songfolder Premium for this song and gain access to the full collection of stock "+e._s(String(e.wizardCode.MediaType).toLowerCase())+" as part of your campaign\n    ")]):e._e()]],2):t("div",{staticClass:"container card px-3 py-0 border-0"},[e.requirements?[t("h6",{staticClass:"mt-4"},[e._v("\n      Requirements\n    ")]),e._v(" "),t("ul",{staticClass:"list-group list-group-flush"},e._l(e.requirements,(function(r,o){return t("li",{key:"req_"+o,staticClass:"list-group-item requirement-item ps-4"},["Verified"==e.resource.FileStatus?t("FontAwesomeIcon",{staticClass:"icon text-success position-absolute",attrs:{icon:["fas","check-circle"]}}):t("FontAwesomeIcon",{staticClass:"icon text-gray-400 position-absolute",attrs:{icon:["fas","dot-circle"]}}),e._v("\n        "+e._s(r)+"\n      ")],1)})),0)]:e._e(),e._v(" "),null!=e.UploadProgress?t("div",[t("div",{staticClass:"progress",staticStyle:{height:"4px"}},[t("div",{staticClass:"progress-bar progress-bar-striped progress-bar-animated bg-primary",style:"width: "+e.UploadProgress+"%",attrs:{role:"progressbar","aria-valuenow":e.UploadProgress,"aria-valuemin":"0","aria-valuemax":"100"}})])]):e._e(),e._v(" "),t("div",{staticClass:"align-self-center py-3 w-100"},["PendingVerification"==e.status?t("button",{staticClass:"btn btn-light btn-rounded w-100 disabled text-nowrap",attrs:{disabled:"disabled"}},[e._v("\n      Pending approval\n    ")]):null!=e.UploadProgress?t("button",{staticClass:"btn btn-light btn-rounded w-100 disabled text-nowrap",attrs:{disabled:"disabled"}},[t("FontAwesomeIcon",{staticClass:"fa-spin",attrs:{icon:["fas","compact-disc"]}}),e._v(" Loading...\n    ")],1):"Verified"==e.resource.FileStatus&&"SongCover"!=e.resource.WizardCode?t("button",{staticClass:"btn btn-rounded btn-outline-dark w-100 text-nowrap",on:{click:function(t){return t.stopPropagation(),e.$refs.fileUploader.click()}}},[e._v("\n      Change\n    ")]):e.uploadAllowed?t("button",{staticClass:"btn btn-rounded btn-primary w-100 text-nowrap",on:{click:function(t){return t.stopPropagation(),e.onProcessUploadClick()}}},[e._v("\n      "+e._s("Rejected"==e.resource.FileStatus?"Upload Update":"Upload Now")+"\n    ")]):"SongCover"!=e.resource.WizardCode?t("button",{staticClass:"btn btn-rounded btn-dark-outline btn-disabled w-100 text-nowrap small",attrs:{disabled:""}},[e._v("\n      Max Space Reached\n    ")]):e._e()]),e._v(" "),t("input",{ref:"fileUploader",staticClass:"d-none",attrs:{type:"file",accept:e.acceptedFileTypes},on:{change:e.onBeginFileUpload}}),e._v(" "),e.UploadError?t("div",{staticClass:"error text-small p-2",staticStyle:{"font-size":"0.75rem"}},[t("FontAwesomeIcon",{staticClass:"text-danger",attrs:{icon:["fas","exclamation-circle"]}}),e._v(" "),t("span",{staticClass:"text-muted fst-italic"},[e._v(e._s(e.UploadError))])],1):e._e()],2)}),[],!1,null,"ac03a8c2",null);t.default=component.exports}}]);